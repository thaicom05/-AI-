
<div class="flex flex-col h-screen max-w-4xl mx-auto">
  <!-- Header -->
  <header class="p-4 border-b border-gray-700 text-center">
    <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-indigo-600">
      สตูดิโอ AI สร้างคอนเทนต์ไวรัล
    </h1>
    <p class="text-sm text-gray-400">ขับเคลื่อนโดย Gemini API</p>
  </header>

  <!-- Message List -->
  <main class="flex-1 overflow-y-auto p-4 space-y-6">
    @if (messages().length === 0) {
      <div class="flex flex-col items-center justify-center h-full text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 14.5M14.25 3.104c.251.023.501.05.75.082M19.8 14.5L14.25 10m-8.25 0l-1.25-1.25a3.375 3.375 0 010-4.749l2.25-2.25a3.375 3.375 0 014.749 0l2.25 2.25a3.375 3.375 0 010 4.749l-1.25 1.25m-8.25 0h2.625m5.625 0h2.625m3.375 0l-1.25-1.25a3.375 3.375 0 010-4.749l2.25-2.25a3.375 3.375 0 014.749 0l2.25 2.25a3.375 3.375 0 010 4.749l-1.25 1.25M19.8 14.5l-7.5-3.333M14.25 10l-7.5 3.333m13.5 1.167v5.714a2.25 2.25 0 01-2.25 2.25h-9a2.25 2.25 0 01-2.25-2.25v-5.714m13.5 0l-3.375-3.375M3.375 10.833l3.375 3.375m0 0L12 10l4.125 4.208" />
          </svg>
          <p class="text-lg">เริ่มต้นสร้างสรรค์ผลงานของคุณ</p>
          <p class="text-sm">เลือกประเภทคอนเทนต์และป้อนไอเดียของคุณด้านล่าง</p>
      </div>
    } @else {
      @for (message of messages(); track message.id) {
        <div class="flex" [class]="message.role === 'user' ? 'justify-end' : 'justify-start'">
          <div class="max-w-xl p-4 rounded-2xl" [class]="message.role === 'user' ? 'bg-indigo-600 text-white rounded-br-none' : 'bg-gray-700 text-gray-200 rounded-bl-none'">
            @switch (message.type) {
              @case ('text') {
                <p class="whitespace-pre-wrap">{{ message.content }}</p>
                @if(message.filePreview) {
                  <img [src]="message.filePreview" alt="User upload preview" class="mt-2 rounded-lg max-h-48">
                }
              }
              @case ('loading') {
                <div class="flex items-center space-x-3">
                  <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <div>
                    <p>{{ message.content }}</p>
                    @if(message.videoStatus) {
                        <div class="mt-2">
                            <p class="text-xs text-gray-400">{{ message.videoStatus.message }}</p>
                            <div class="w-full bg-gray-600 rounded-full h-1.5 mt-1">
                                <div class="bg-indigo-500 h-1.5 rounded-full" [style.width.%]="message.videoStatus.progress"></div>
                            </div>
                        </div>
                    }
                  </div>
                </div>
              }
              @case ('video') {
                <video [src]="message.content" controls class="rounded-lg max-w-full"></video>
              }
              @case ('image') {
                <img [src]="message.content" alt="Generated by AI" class="rounded-lg max-w-full">
              }
              @case ('error') {
                <div class="flex items-center text-red-400 space-x-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                  </svg>
                  <p>{{ message.content }}</p>
                </div>
              }
            }
          </div>
        </div>
      }
    }
  </main>

  <!-- Prompt Form -->
  <footer class="shrink-0">
    <app-prompt-form (submitPrompt)="handlePrompt($event)"></app-prompt-form>
  </footer>
</div>
